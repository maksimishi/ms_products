# Каталог товаров МойСклад с интеграцией Национального каталога

Flask приложение для отображения товаров из МойСклад с фильтрацией по флажку "Для нац.каталога" и возможностью отправки данных в Национальный каталог.

## Возможности

- Получение данных из API МойСклад
- Фильтрация товаров по кастомному атрибуту "Для нац.каталога" 
- Отображение основных характеристик товаров
- Поддержка вариантов товаров с характеристиками
- Адаптивный веб-интерфейс
- API endpoint для получения данных в JSON
- Интеграция с Национальным каталогом:
  - Предварительный просмотр карточки товара для НК
  - Отправка товаров в Национальный каталог
  - Проверка статуса фида
  - Автоматическое определение категории по ТН ВЭД
  - Валидация цветов и видов товаров

## Установка

1. **Клонируйте репозиторий или создайте файлы:**
```bash
mkdir moysklad-catalog
cd moysklad-catalog
```

2. **Создайте виртуальное окружение:**
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# или
venv\Scripts\activate  # Windows
```

3. **Установите зависимости:**
```bash
pip install -r requirements.txt
```

4. **Настройте .env файл:**
```bash
cp .env.example .env
```
Отредактируйте `.env` и добавьте необходимые токены:
```
MS_TOKEN=ваш_токен_мойсклад
NC_API_KEY=ваш_токен_национальный_каталог
```

5. **Настройте конфигурацию в config.py:**
Убедитесь, что названия кастомных атрибутов соответствуют вашим настройкам в МойСклад.

## Запуск

```bash
python app.py
```

Приложение будет доступно по адресу: http://localhost:5000

## Доступные страницы

- `/` - Главная страница с каталогом товаров
- `/api/products` - API endpoint для получения данных в JSON
- `/nk_preview/<product_index>` - Предварительный просмотр карточки товара для НК
- `/send_to_nk/<product_index>` - Отправка товара в Национальный каталог
- `/check_feed_status/<feed_id>` - Проверка статуса фида в НК

## Структура проекта

```
├── app.py              # Основное приложение
├── config.py           # Конфигурация атрибутов и настроек
├── nk_api.py          # Функции для работы с API НК
├── requirements.txt    # Зависимости
├── .env               # Переменные окружения
├── README.md          # Документация
└── templates/
    ├── index.html     # Главная страница
    └── error.html     # Страница ошибок
```

## Документация

Ссылка на официальную документацию API МойСклад расположена в файле `doc/mc.txt`.

## Настройка кастомных атрибутов

В файле `config.py` настройте соответствие названий атрибутов:

```python
CUSTOM_ATTRIBUTES = {
    'national_catalog': 'Для нац.каталога',  # Точное название флажка
    'composition': 'Состав',
    'permit_docs': 'Разрешительная документация', 
    'product_type': 'Вид товара',
    'color': 'Цвет',
    'size': 'Размер',
    'brand_nk': 'Бренд НК'
    'target_gender': 'Целевой пол',
    'size_type': 'Вид размера'
}
```


Если обязательные поля отсутствуют в вашем аккаунте МойСклад, их можно создать
непосредственно из интерфейса. На странице таблицы вверху расположена кнопка
«Проверить доп. поля». При нажатии открывается модальное окно со списком
обязательных атрибутов. Для каждого отсутствующего поля доступна кнопка
«Создать», а также есть возможность создать все недостающие поля одной кнопкой.

## Отображаемые данные

- **Наименование** - основное название товара
- **Артикул** - артикул товара
- **Состав** - состав товара (кастомный атрибут)
- **Разрешительная документация** - документы (кастомный атрибут)
- **Цвет** - цвет из атрибутов или характеристик вариантов
- **Размер** - размер из атрибутов или характеристик вариантов
- **ТН ВЭД** - код товарной номенклатуры
- **Бренд НК** - бренд для Национального каталога
- **Целевой пол** - значение пользовательского поля
- **Вид размера** - значение пользовательского поля; используется как `attr_value_type` для атрибута «Размер»
=======



## Интеграция с Национальным каталогом

Приложение поддерживает следующие функции для работы с НК:

1. **Предварительный просмотр** - проверка корректности данных перед отправкой
2. **Отправка товаров** - автоматическое создание карточек товаров
3. **Проверка статуса** - мониторинг процесса обработки фида
4. **Валидация данных** - проверка корректности цветов и видов товаров
5. **Автоматическое определение категории** - по коду ТН ВЭД

